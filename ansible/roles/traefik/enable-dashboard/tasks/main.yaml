---
- name: Render Dashboard Secret YAML file
  delegate_to: "{{ groups['rke2_servers'][0] }}"
  run_once: true
  template:
    src: secret-dashboard.yaml.j2
    dest: /tmp/secret-dashboard.yaml
  ignore_errors: true

- name: Apply Dashboard Secret using kubectl
  delegate_to: "{{ groups['rke2_servers'][0] }}"
  run_once: true
  command: kubectl apply -f /tmp/secret-dashboard.yaml --kubeconfig /etc/rancher/rke2/rke2.yaml

- name: Render Dashboard Middleware YAML file
  delegate_to: "{{ groups['rke2_servers'][0] }}"
  run_once: true
  template:
    src: middleware.yaml.j2
    dest: /tmp/middleware.yaml

- name: Apply Dashboard Middleware using kubectl
  delegate_to: "{{ groups['rke2_servers'][0] }}"
  run_once: true
  command: kubectl apply -f /tmp/middleware.yaml --kubeconfig /etc/rancher/rke2/rke2.yaml

- name: Render Dashboard Ingress YAML file
  delegate_to: "{{ groups['rke2_servers'][0] }}"
  run_once: true
  template:
    src: ingress.yaml.j2
    dest: /tmp/ingress.yaml

- name: Apply Dashboard Ingress using kubectl to Access Service
  delegate_to: "{{ groups['rke2_servers'][0] }}"
  run_once: true
  command: kubectl apply -f /tmp/ingress.yaml --kubeconfig /etc/rancher/rke2/rke2.yaml
